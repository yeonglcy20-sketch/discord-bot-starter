const { Events } = require('discord.js');

// ì¹´í…Œê³ ë¦¬ë³„ ë©”ë‰´
const menusByCat = {
  'í•œì‹': [
    'ðŸ¥˜ ê¹€ì¹˜ì°Œê°œ','ðŸ¥˜ ëœìž¥ì°Œê°œ','ðŸ² ë¶€ëŒ€ì°Œê°œ','ðŸ² ê°ìžíƒ•','ðŸ² ìˆœë‘ë¶€ì°Œê°œ','ðŸ² í•´ìž¥êµ­',
    'ðŸœ ëƒ‰ë©´','ðŸœ ì¹¼êµ­ìˆ˜','ðŸœ ìž”ì¹˜êµ­ìˆ˜','ðŸœ ì½©êµ­ìˆ˜','ðŸš ë¹„ë¹”ë°¥','ðŸš ëŒì†¥ë¹„ë¹”ë°¥',
    'ðŸ– ë¶ˆê³ ê¸°','ðŸ¥“ ì‚¼ê²¹ì‚´','ðŸ– ê°ˆë¹„íƒ•','ðŸ— ë‹­ê°ˆë¹„','ðŸ— ë‹­í•œë§ˆë¦¬','ðŸ— ì‚¼ê³„íƒ•',
    'ðŸ¥Ÿ ë§Œë‘ì „ê³¨','ðŸ¥© ìœ¡íšŒë¹„ë¹”ë°¥','ðŸ¥“ ì œìœ¡ë³¶ìŒ','ðŸ¥¢ ì˜¤ì§•ì–´ë³¶ìŒ','ðŸ¦‘ ë‚™ì§€ë³¶ìŒ',
    'ðŸ¥˜ ìˆœëŒ€êµ­','ðŸ¥˜ ê³±ì°½ì „ê³¨','ðŸ¥˜ ë¼ˆí•´ìž¥êµ­','ðŸ¥Ÿ ê¹€ì¹˜ì „','ðŸ¥ž í•´ë¬¼íŒŒì „','ðŸŒ¯ ê¹€ë°¥',
    'ðŸŒ¶ï¸ ë‹­ë°œ','ðŸ– ì¡±ë°œ','ðŸ¥© ë³´ìŒˆ','ðŸ”¥ ë§¤ìš´ë–¡ë³¶ì´','ðŸ¢ ì–´ë¬µíƒ•','ðŸœ ë¼ë³¶ì´'
  ],
  'ì¼ì‹': [
    'ðŸ£ ì´ˆë°¥','ðŸŸ ì‚¬ì‹œë¯¸','ðŸ› ì¼ë³¸ì‹ ì¹´ë ˆ','ðŸœ ë¼ë©˜','ðŸœ ìš°ë™','ðŸ¥¢ ì•¼í‚¤ì†Œë°”',
    'ðŸ¥© ëˆì¹´ì¸ ','ðŸš ê°€ì¸ ë™','ðŸ¤ í…ë™','ðŸ² ë‚˜ë² ','ðŸ™ ì˜¤ë‹ˆê¸°ë¦¬','ðŸ™ íƒ€ì½”ì•¼í‚¤','ðŸ¥Ÿ êµìž','ðŸ¥¢ ì˜¤ì½”ë…¸ë¯¸ì•¼í‚¤'
  ],
  'ì¤‘ì‹': [
    'ðŸœ ì§œìž¥ë©´','ðŸ”¥ ì§¬ë½•','ðŸ– íƒ•ìˆ˜ìœ¡','ðŸ¥˜ ë§ˆíŒŒë‘ë¶€','ðŸ¥© ë¼ì¡°ê¸°','ðŸ¤ ê¹ì‡¼ìƒˆìš°',
    'ðŸ¥© ìœ ì‚°ìŠ¬','ðŸš ë³¶ìŒë°¥','ðŸœ ìš°ìœ¡ë©´','ðŸŒ¶ï¸ ë§ˆë¼íƒ•','ðŸŒ¶ï¸ ë§ˆë¼ìƒ¹ê¶ˆ','ðŸ² í› ê¶ˆ','ðŸ¥Ÿ ë”¤ì„¬'
  ],
  'ì–‘ì‹': [
    'ðŸ• í”¼ìž','ðŸ í† ë§ˆí†  íŒŒìŠ¤íƒ€','ðŸ¥› í¬ë¦¼ íŒŒìŠ¤íƒ€','ðŸ§„ ì•Œë¦¬ì˜¤ì˜¬ë¦¬ì˜¤','ðŸ¥© ìŠ¤í…Œì´í¬',
    'ðŸ” ë ë“œë²„ê±°','ðŸŒ­ í•«ë„ê·¸','ðŸ¥— ì‹œì €ìƒëŸ¬ë“œ','ðŸš ë¦¬ì¡°ë˜','ðŸ¥˜ ë¹„í”„ìŠ¤íŠœ','ðŸ¥ª íŒŒë‹ˆë‹ˆ'
  ],
  'ë™ë‚¨ì•„': [
    'ðŸœ í¼(ìŒ€êµ­ìˆ˜)','ðŸ¥— ë¶„ì§œ','ðŸ¥– ë°˜ë¯¸','ðŸœ ì¹´ì˜¤ì˜ì´','ðŸ íŒŸíƒ€ì´',
    'ðŸš ì¹´ì˜¤íŒŸ(ë³¶ìŒë°¥)','ðŸ¦ ë˜ ì–Œê¿','ðŸ› ë½ì‚¬'
  ],
  'ì¸ë„/ì¤‘ë™': [
    'ðŸ› ë²„í„°ì¹˜í‚¨ ì»¤ë¦¬','ðŸ¥˜ íŒ”ë½ íŒŒë‹ˆë¥´','ðŸ¥˜ ë‹¬(ë Œí‹¸) ì»¤ë¦¬','ðŸ«“ ë‚œ','ðŸ¥Ÿ ì‚¬ëª¨ì‚¬',
    'ðŸ¥™ ì¼€ë°¥','ðŸŒ¯ ìƒ¤ì™€ë¥´ë§ˆ','ðŸ¥— íŒ”ë¼íŽ ','ðŸ¥£ í›„ë¬´ìŠ¤'
  ],
  'ë¶„ì‹/ì•¼ì‹': [
    'ðŸ— ì¹˜í‚¨','ðŸŸ ê°ìžíŠ€ê¹€','ðŸŒ® íƒ€ì½”','ðŸŒ¯ ë¶€ë¦¬ë˜','ðŸœ ì»µë¼ë©´',
    'ðŸ¢ ì˜¤ëŽ…ë°”','ðŸ• ì•¼ì‹ í”¼ìž','ðŸ¥ª íŽ¸ì˜ì  ìƒŒë“œìœ„ì¹˜'
  ],
  'ê°„ë‹¨ì‹': [
    'ðŸ¥ª ìƒŒë“œìœ„ì¹˜','ðŸ¥¯ ë² ì´ê¸€','ðŸž í† ìŠ¤íŠ¸','ðŸ™ ì£¼ë¨¹ë°¥','ðŸ¥— ìƒëŸ¬ë“œë³¼','ðŸ± ë„ì‹œë½'
  ],
  'ë””ì €íŠ¸': [
    'ðŸ§ ë¹™ìˆ˜','ðŸ¦ ì•„ì´ìŠ¤í¬ë¦¼','ðŸ§‡ ì™€í”Œ','ðŸ¥ž í¬ë ˆì´í”„','ðŸ© ë„ë„›',
    'ðŸ° ì¹˜ì¦ˆì¼€ì´í¬','ðŸ° í‹°ë¼ë¯¸ìˆ˜','ðŸ® í‘¸ë”©','ðŸ« ì´ˆì½œë¦¿ ì¼€ì´í¬','ðŸª ì¿ í‚¤','ðŸ§ ì»µì¼€ì´í¬'
  ],
  'ì±„ì‹': [
    'ðŸ¥— ë‘ë¶€ìƒëŸ¬ë“œ','ðŸ¥™ ë¹„ê±´ ëž©','ðŸ” ë¹„ê±´ ë²„ê±°','ðŸ í† ë§ˆí†  ì±„ì‹ íŒŒìŠ¤íƒ€','ðŸ² ì•¼ì±„ ìŠ¤íŠœ'
  ]
};
const ALL = Object.values(menusByCat).flat();

function sampleWithoutReplace(arr, k) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; }
  return a.slice(0, Math.max(0, Math.min(k, a.length)));
}

// ì¹´í…Œê³ ë¦¬ ìž…ë ¥ ë³´ì • (ë™ì˜ì–´/ì¤„ìž„ë§)
function normalizeCat(raw) {
  if (!raw) return null;
  const s = raw.replace(/\s+/g, '').toLowerCase();
  if (['í•œì‹','k','kr','korea','k-food'].includes(s)) return 'í•œì‹';
  if (['ì¼ì‹','jp','japan','j-food','ì¼'].includes(s)) return 'ì¼ì‹';
  if (['ì¤‘ì‹','cn','china','c-food','ì¤‘'].includes(s)) return 'ì¤‘ì‹';
  if (['ì–‘ì‹','w','western','ì–‘'].includes(s)) return 'ì–‘ì‹';
  if (['ë¶„ì‹','ì•¼ì‹','ë¶„ì‹ì•¼ì‹','night'].includes(s)) return 'ë¶„ì‹/ì•¼ì‹';
  if (['ë™ë‚¨ì•„','seasia','asean','ë™'].includes(s)) return 'ë™ë‚¨ì•„';
  if (['ì¸ë„','ì¤‘ë™','ì¸ë„ì¤‘ë™','indo','me','middleeast'].includes(s)) return 'ì¸ë„/ì¤‘ë™';
  if (['ê°„ë‹¨ì‹','ê°„ë‹¨','simple','light'].includes(s)) return 'ê°„ë‹¨ì‹';
  if (['ë””ì €íŠ¸','dessert','sweet'].includes(s)) return 'ë””ì €íŠ¸';
  if (['ì±„ì‹','ë¹„ê±´','vegan','veg'].includes(s)) return 'ì±„ì‹';
  return null;
}

client.on(Events.MessageCreate, async (msg) => {
  try {
    if (msg.author.bot) return;
    if (!msg.guild) return; // DMì€ ë¬´ì‹œ (ì›í•˜ë©´ í—ˆìš© ê°€ëŠ¥)

    // í˜•ì‹: /ë©”ì¶” [ì¹´í…Œê³ ë¦¬] [ê°œìˆ˜]
    const m = msg.content.trim();
    if (!m.startsWith('/ë©”ì¶”')) return;

    const parts = m.split(/\s+/).slice(1); // [/ë©”ì¶”, ...]ì—ì„œ ì¸ìžë§Œ
    const rawCat = parts[0];
    const rawCnt = parts[1];

    const cat = normalizeCat(rawCat) || (rawCat ? rawCat : null);
    const count = Math.min(5, Math.max(1, parseInt(rawCnt, 10) || 1));

    let pool, label;
    if (!cat) {
      pool = ALL;
      label = 'ì „ì²´';
    } else if (menusByCat[cat]) {
      pool = menusByCat[cat];
      label = cat;
    } else {
      // ì§€ì› ì¹´í…Œê³ ë¦¬ ì•ˆë‚´
      const cats = Object.keys(menusByCat).join(', ');
      return msg.reply(`ì‚¬ìš©ë²•: \`/ë©”ì¶” [ì¹´í…Œê³ ë¦¬] [ê°œìˆ˜]\`\nì˜ˆ) \`/ë©”ì¶” í•œì‹\`, \`/ë©”ì¶” í•œì‹ 3\`\nê°€ëŠ¥í•œ ì¹´í…Œê³ ë¦¬: ${cats}`);
    }

    const picks = sampleWithoutReplace(pool, count);
    await msg.reply(`ì˜¤ëŠ˜ ë©”ë‰´ ì¶”ì²œ${count > 1 ? ` (${label}, ${count}ê°œ)` : ` (${label})`}: ${picks.map(p => `**${p}**`).join(', ')}`);
  } catch (e) {
    console.error('ë©”ì¶” ì²˜ë¦¬ ì˜¤ë¥˜:', e);
  }
});
